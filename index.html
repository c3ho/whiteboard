<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>My Web Notepad</title>
    <link rel="stylesheet" href="https://unpkg.com/papercss@1.6.1/dist/paper.css">
</head>

<body>
    <script src="https://unpkg.com/filer/dist/filer.min.js"></script>
    <script src="https://unpkg.com/hotkeys-js/dist/hotkeys.min.js"></script>

    <div class="paper container" id="notepad" contenteditable="true"></div>
    <script>
        const fs = new Filer.FileSystem();

        hotkeys.filter = function (event) {
            return true;
        }

        //How to add the filter to edit labels. <div contentEditable="true"></div>
        //"contentEditable" Older browsers that do not support drops
        hotkeys.filter = function (event) {
            var tagName = (event.target || event.srcElement).tagName;
            return !(tagName.isContentEditable || tagName == 'INPUT' || tagName == 'SELECT' || tagName == 'TEXTAREA');
        }

        hotkeys.filter = function (event) {
            var tagName = (event.target || event.srcElement).tagName;
            hotkeys.setScope(/^(INPUT|TEXTAREA|SELECT)$/.test(tagName) ? 'input' : 'other');
            return true;
        }

        //prevents windows from trying to save html page and instead calls save function
        hotkeys('ctrl+s', function(){
            event.preventDefault();
            console.log('hotkey for save pressed (ctrl+s)');
            save();
        })

        window.addEventListener('DOMContentLoaded', (event) => {
            fs.readFile('/note', 'utf8', function (err, data) {
                var str;
                if (err) {
                    str = "Welcome to my notepad!";
                    document.querySelector('#notepad').innerHTML = str;
                }
                else if (data) {
                    document.querySelector('#notepad').innerHTML = data;
                }
            })
            //calls recently written save function every 2s
            //var saveInterval = setInterval(save, 2000);
        })

        //save function
        function save() {
            fs.writeFile('/note', document.querySelector('#notepad').innerHTML, (err) => {
                if (err) throw err;
                console.log('The file has been saved');
            });
        }
    </script>
</body>

</html>